{% extends 'base.html' %}

{% block head %}
    <title>"Turtles"</title>
{% endblock %}

{% block body %}
    <h1>All Turtles</h1>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Favorite</th>
            </tr>
        </thead>
        <tbody>
            {% for turtle in turtles %}
            <tr>
                <td>{{ turtle.id }}</td>
                <td>{{ turtle.name }}</td>
                <td>
                    <label>
                        <input
                        type="checkbox"
                        class="favorite-checkbox"
                        data-turtle-id="{{ turtle.id }}"
                        {% if turtle in favorites %} checked {% endif %}>
                    </label>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
    document.querySelectorAll('.favorite-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const turtleId = this.dataset.turtleId;
            const isFavorite = this.checked;

            fetch('/update_favorite', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token() }}'
                },
                body: JSON.stringify({ turtle_id: turtleId, favorite: isFavorite })
            })
            .then(response => response.json())
            .then(data => {
                if (!data.success) {
                    alert('Error updating favorite status!');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error updating favorite status!');
            });
        });
    });
    </script>
{% endblock %}
